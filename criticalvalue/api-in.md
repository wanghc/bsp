
<style>
table td:first-of-type {
    word-break:keep-all;
}
</style>

## 危急值管理平台 内部接口 ##

### 1. 前言 ###
档描述了危急值管理平台为其他产品组提供的标准接口，接口通过类方法或Query提供。

### 2. 接口列表 ###

#### 2.1 保存危急值 ####

适应于医技系统保存危急值，如果为第三方或分库则应通过平台调用。
```vb
##Class(web.DHCAntService).SaveCVResult(ReportType,ExamNo,Adm,OEOrdId,ReportInfo,Result,LisRowid,OrderInfo,TestItems )
##Class(web.DHCAntCVResult).Save(ReportType,ExamNo,Adm,OEOrdId,ReportInfo,Result,LisRowid,OrderInfo,TestItems) //检验调的可能是这个
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| ReportType   | 危急值类型    | 1检验,2病理,3心电,4超声,5内镜,6放射 |
| ExamNo    | 检查(检验)号    |  |
| Adm   | 就诊ID    | 发送消息时传的OEOrdItemId |
| OEOrdId   | 医嘱ID    | 多个医嘱以英文逗号,分隔 |
| ReportInfo   | 报告审核信息    | 审核日期(yyyy-MM-dd)^审核时间(hh:mm:ss)^审核人ID^审核说明^报告审核科室 |
| Result   | 危急值报告内容    | 危急值报告内容 |
| LisRowid   | 唯一ID    | 一个检查(检验)号可能调用多次，需要唯一ID来区分哪次调用 |
| OrderInfo   | 医嘱信息，后续添加串    | 申请人^申请日期时间^采集人^采集日期时间^接收人^接收日期时间^预警日期时间^复核人^复核日期时间^报告人^报告日期时间(审核日期时间)^标本类型^危机说明^备注     (时间格式：YYYY-MM-DD  hh:mm:ss) |
| TestItems   | 检验项目结果    | $lb($lb(项目代码,项目名称,缩写,结果,单位,结果异常标志,范围,仪器,备注),$lb(项目代码,项目名称,缩写,结果,单位,结果异常标志,范围,仪器,备注)) |
| Expand   | 扩展信息 `未实现`   | 临床电话日期(yyyy-MM-dd)^电话时间(hh:mm:ss)^备注^临床接电话人^临床电话^医技人员姓名^医技电话 |


|*返回值* |*说明*|*备注*|
| --- | -- | -- |
|0|成功||
|-1^失败原因|||



#### 2.2 根据就诊判断是否有需处理危急值 ####

适应于根据就诊ID判断是否存在需处理的危急值报告。
```vb
##Class(web.DHCAntService).GetReportWarn(EpisodeId)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| EpisodeId   | 就诊ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
|1|有||
|0|无||


#### 2.3 根据就诊获取需处理的危急值报告数量 ####

适应于根据就诊ID获取需处理的危急值报告数量。
```vb
##Class(web.DHCAntService).GetReportWarnNum(EpisodeId)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| EpisodeId   | 就诊ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
|数字|需处理的危急值报告数量||


#### 2.4 根据检查(验)号与医嘱ID判断是否是危急值 ####

适应于根据检查(验)号与医嘱ID判断是否是危急值。
```vb
##Class(web.DHCAntService).IsCVReport(ExamNo,OEOrdId)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| ExamNo   | 检查(检验)号    |  |
| OEOrdId   | 医嘱ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
|0|否||
|1^危急值RowId|||


#### 2.5 根据就诊ID获取危急值列表 ####

适应于根据就诊ID获取危急值列表。
```vb
##class(%ResultSet).RunQuery("web.DHCCVCommon","CVReportFromAdm",EpisodeId,TransStatus)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| EpisodeId   | 就诊ID    |  |
| TransStatus   | 危急值状态    | C未处理 F已处理 <br>在新版本中C未接收未处理 Rec已接收未处理 F已处理 且支持多个英文,分隔 |

|*输出列* |*说明*|*备注*|
| --- | -- | -- |
| ReportId | 报告ID | 检查(验)号&#124;&#124;计数 |
| TSName | 医嘱名称 |  |
| ReportStatus | 危急值状态 |  |
| ReportType | 危急值类型名称 |  |
| DPRPType | 危急值类型代码 |  |
| DateTime | 报告日期时间 |  |
| ApplyDT | 申请日期时间 |  |
| SamplingDT | 采样日期时间 |  |
| ReceiveDT | 接收日期时间 |  |
| AuditDT | 审核日期时间 |  |
| Specimen | 标本 |  |
| DPRPAlert | 提示 |  |




#### 2.6 危急值与医嘱关联 ####

适应于保存危急值与医嘱关联。
```vb
##Class(BSP.CV.SRV.Interface).SaveTransOrd(reportID,OEOrdItemIds,UserID)
##class(web.DHCAntCVReportLink).SaveTransOrd(reportID,OEOrdItemIds,UserID)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    | 危急值报告ID  打开界面传过去的AntCVID |
| OEOrdItemIds   | 医嘱ID    | 多个以英文,分割 |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 成功 |  |
| -1^失败原因 |  |  |



#### 2.7 是不是为处理危急值而开的医嘱 ####

适应于判断是不是为处理危急值而开的医嘱。
```vb
##Class(BSP.CV.SRV.Interface).IsTransOrd(OEOrdItemId)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| OEOrdItemId   | 医嘱ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 0 | 不是 |  |
| 1^附加信息 | 是 | 1^危急值报告ID1$危急值报告ID2 |



#### 2.8 危急值与病历关联 ####

适应于保存危急值与病历关联。
```vb
##Class(BSP.CV.SRV.Interface).SaveTransEMR(reportID,OEOrdItemIds,UserID)   //实际未使用此
##class(web.DHCAntCVReportLink).SaveTransEMR(reportID,OEOrdItemIds,UserID)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    | 危急值报告ID  打开界面传过去的FromCode |
| InstanceIDs   | 病历ID    |  |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 成功 |  |
| -1^失败原因 |  |  |



#### 2.9 是不是为处理危急值而写的病程 ####

适应于判断是不是为处理危急值而写的病程。
```vb
##Class(BSP.CV.SRV.Interface).IsTransEMR(InstanceID)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| InstanceID   | 病历ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 0 | 不是 |  |
| 1^附加信息 | 是 | 1^危急值报告ID1$危急值报告ID2 |


#### 2.10 是否需要弹出危急值界面 ####

适应于根据就诊或患者ID判断是否需要弹出危急值。 `2023-02-13`

判断此患者历次就诊是否有未处理的危急值，有则返回此患者危急值列表链接，无则返回空

```vb
##Class(BSP.CV.SRV.Interface).GetCVPopupUrl(EpisodeID)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| EpisodeID   | 就诊ID    |  |
| PatientID   | 患者ID    | 就诊ID和患者ID 至少传一个  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 空 | 不需要 |  |
| 其它 | 需要 | 返回值为要弹出的链接 |


#### 2.11 根据危急值ID获取危急值信息以及开具的医嘱 ####

适应于根据危急值ID获取危急值信息及开的医嘱。 
```vb
##Class(BSP.CV.SRV.Interface).GetOneCVInfo(reportID)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 空 | 获取失败 |  |
| 对象 | 获取成功 | `BSP.SYS.COM.ProxyObject`对象 |

成功返回的是`BSP.SYS.COM.ProxyObject`对象，具体属性

|*属性名* |*说明*|*备注*|
| --- | -- | -- |
| reportID | 危急值id |  |
| examNo | 检验(检查)号 |  |
| repResult | 危急值报告内容 |  |
| repType | 危急值类型 |  |
| repTypeDesc | 危急值类型描述 | 
| ordItemId | 此检验(检查)的医嘱Id | 部分项目可能是多个医嘱id,英文,分隔 |
| ordItemDesc | 此检验(检查)的医嘱名称 |  |
| repLoc | 报告科室 | 取的医嘱接收科室 |
| repUserName | 报告人名字 |  |
| repDate | 报告日期 | Logical |
| repTime | 报告时间 | Logical |
| repDT | 报告日期时间 | 系统配置日期格式 HH:mm:ss |
| trUserName | 处理人名字 |  |
| trDate | 处理日期 | Logical |
| trTime | 处理时间 | Logical |
| trDT | 处理日期时间 | 系统配置日期格式 HH:mm:ss |
| trAdvice | 处理意见措施 | 处理界面的意见措施录入框的值 |
| trOrdItemList | 处理医嘱 | 数组(BSP.SYS.COM.ProxyArray） 详细见下表 |
| admDT | 就诊时间 | 系统配置日期格式 HH:mm:ss     （2020-04-15增加） |
| admLocDesc | 就诊科室 | （2020-04-15增加） |
| admDocName | 主管医生 | （2020-04-15增加） |
| adm | 就诊id | （2020-04-15增加） |
| patPhone | 患者手机 | （2020-04-15增加） |
| patientID | 患者ID | （2020-04-15增加） |
| recUserName | 接收人名字 | （2020-04-22增加） |
| recDate | 接收日期 | Logical （2020-04-22增加） |
| recTime | 接收时间 | Logical（2020-04-22增加） |
| recDT | 接收日期时间 | 系统配置日期格式 HH:mm:ss （2020-04-22增加） |

处理医嘱trOrdItemList的元素说明

|*属性名* |*说明*|*备注*|
| --- | -- | -- |
| ordItemId | 医嘱id |  | 
| ordDesc | 医嘱名称 |  | 
| ordAddDate | 医嘱开立日期 | Logical | 
| ordAddTime | 开立时间 | Logical | 
| ordAddDT | 开立日期时间 | 系统配置日期格式 HH:mm:ss | 
| ordDocName | 开医嘱人名字 |  | 
| ordLocDesc | 开医嘱科室 |  | 
| ordRecLocDesc | 医嘱接收科室 |  | 
| ordDoseQty | 单次剂量 |  | 
| ordDoseUnit | 单次剂量单位 |  | 
| ordPHFreq | 频次 |  | 
| ordInstrDr | 用法 |  | 
| ordDura | 疗程 |  | 



#### 2.12 获取某就诊最近一次危急值信息 ####

适应于获取某就诊最近一次危急值信息。 `个别项目实现`
```vb
##Class(BSP.CV.SRV.Interface).GetLatestOneCVInfo(EpisodeID,Status)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| EpisodeID   | 就诊ID    |  |
| Status   | 状态    |  |


|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 空 | 获取失败 |  |
| 对象 | 获取成功 | `BSP.SYS.COM.ProxyObject`对象<br> 具体属性见上接口 |



#### 2.13 根据就诊ID获取危急值列表V2 ####

适应于根据就诊ID获取危急值列表。
```vb
##class(%ResultSet).RunQuery("web.DHCAntService","QryCVByAdm",Adm,Status,DateFrom,DateTo,UseType,ReportType)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |  |
| Status   | 危急值状态    | C未接收未处理 Rec已接收未处理 F已处理 空全部 且支持多个英文,分隔 |
| DateFrom   | 开始日期    |  |
| DateTo   | 结束日期    |  |
| UseType  | 用途    | NURSE-TODO 护士待处理(不同项目护士待处理条件不一样，接口内部去判断)<br>NURSE-DONE 护士已处理(不同项目护士待处理条件不一样，接口内部去判断) <br>（2022-04-22增加）|
| ReportType   | 危急值报告类型    | 1检验、2病理、3心电、4超声、5内镜、6放射  多个以,分割<br> （2023-02-10） |


|*输出列* |*说明*|*备注*|
| --- | -- | -- |
| reportID | 报告ID | 危急值报告表RowId | 
| examno | 检查(检验)号 |  | 
| ordItem | 医嘱ID |  | 
| repStatus | 危急值报告状态 |  | 
| repTypeDesc | 报告类型 |  | 
| repLoc | 报告科室 |  | 
| repDate | 报告日期 |  | 
| repTime | 报告时间 |  | 
| repResult | 报告结果 |  | 
| trUser | 处理人 |  | 
| trAdvice | 处理意见 |  | 
| ordItemDesc | 医嘱名称 |  | 
| trDate | 处理日期 |  | 
| trTime | 处理时间 |  | 
| nurseDoneStatus | 护士是否处理完成（1/0） | 一般指危急值是否已接收,个别项目也为护士处理  | 
| recUser | 接收人 |  | 
| recAdvice | 接收备注 |  | 
| recDate | 接收日期 |  | 
| recTime | 接收时间 |  | 


#### 2.14 危急值与会诊申请关联 ####

适应于危急值处理时进行会诊申请，保存危急值与会诊申请关联。
```vb
##Class(BSP.CV.SRV.Interface).SaveTransConsultation(reportID,CstID,UserID)   
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    | 危急值报告ID  |
| CstID   | 会诊ID    |  |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 成功 |  |
| -1^失败原因 |  |  |


#### 2.15 危急值与复查记录关联 ####

适应于保存危急值复查记录与危急值关联。 `个别项目`
```vb
##Class(BSP.CV.SRV.Interface).SaveReexamineEMR(reportID,InstanceID,UserID)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    | 危急值报告ID  |
| InstanceID   | 病历ID    |  |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 成功 |  |
| -1^失败原因 |  |  |


#### 2.16 患者新就诊记录时 ####

适应于患者新就诊（产生了就诊记录有了科室、病区后）时调用，处理患者之前的危急值数据（如处理消息，发新消息，修改危急值最终科室）。  `个别项目`
```vb
##Class(BSP.CV.SRV.Interface).OnNewAdm(Adm,UserID)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 成功 |  |
| -1^失败原因 |  |  |


#### 2.17 患者转科后 ####

适应于患者转科后(就诊记录上科室病区改变后)调用，处理患者之前的危急值数据（如处理消息，发新消息，修改危急值最终科室）。  `个别项目`
```vb
##Class(BSP.CV.SRV.Interface).OnTransLoc(Adm,UserID)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 成功 |  |
| -1^失败原因 |  |  |


#### 2.18 获取危急值处理意见措施 ####

适应于为医技系统提供获取危急值处理意见措施接口。  

只会根据条件查到最后一条危急值，然后返回它最后一条处理记录的意见措施字段。ReportType,ExamNo,OEOrdId,LisRowid 都对应危急值保存时的参数

```vb
##Class(BSP.CV.SRV.Interface).GetTransAdvice(ReportType, ExamNo, OEOrdId, LisRowid)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| ReportType   | 危急值类型    | 1检验,2病理,3心电,4超声,5内镜,6放射   |
| ExamNo   | 检查(检验)号    |  |
| OEOrdId   | 医嘱ID   |  |
| LisRowid   | 唯一ID   | 一般为医技系统的危急值ID |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| -1^失败原因 | 失败 |  |
| 其它 | 成功 | 返回值为意见措施(可能为空) |


#### 2.19 保存医技系统确认危急值处理结果 ####

适应于医技系统用户确认收到临床处理结果时调用。  

ReportType,ExamNo,OEOrdId,LisRowid 都对应危急值保存时的参数

```vb
##Class(BSP.CV.SRV.Interface).SaveTPSConfirmExec(ReportType, ExamNo, OEOrdId, LisRowid, UserCode)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| ReportType   | 危急值类型    | 1检验,2病理,3心电,4超声,5内镜,6放射   |
| ExamNo   | 检查(检验)号    |  |
| OEOrdId   | 医嘱ID   |  |
| LisRowid   | 唯一ID   | 一般为医技系统的危急值ID |
| UserCode   | 确认人工号   | 需在HIS内存在 |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| -1^失败原因 | 失败 |  |
| 1 | 成功 |  |

#### 2.20 危急值撤销 ####

适应于为医技系统提供获取危急值撤销接口。  

只会根据条件查到最后一条危急值，然后撤销。已处理的危急值不能撤销。ReportType,ExamNo,OEOrdId,LisRowid 都对应危急值保存时的参数。

```vb
##Class(BSP.CV.SRV.Interface).SaveCVCancel(ReportType, ExamNo, OEOrdId, LisRowid, CancelUserCode,CancelNote)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| ReportType   | 危急值类型    | 1检验,2病理,3心电,4超声,5内镜,6放射   |
| ExamNo   | 检查(检验)号    |  |
| OEOrdId   | 医嘱ID   |  |
| LisRowid   | 唯一ID   | 一般为医技系统的危急值ID |
| CancelUserCode   | 撤销用户工号   | 需在HIS内存在 |
| CancelNote   |  撤销说明备注  |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| -1^失败原因 | 失败 |  |
| 1 | 成功 |  |


#### 2.21 获取患者(待处理/已处理)危急值列表(护士) ####

适应于为护理提供获取某患者危急值列表。  


```vb
##Class(BSP.CV.SRV.Interface).GetAdmCVRS4Nurse(Adm, DoneStatus)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |    |
| DoneStatus   | 完成状态    | 0 未完成 <br> 1 已完成（护士已接收，个别也称已处理）<br>空 不限制 |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 结果集 | 结果集 |  结果集字段说明见 <a href="#213-根据就诊id获取危急值列表v2">2.13 根据就诊ID获取危急值列表V2</a> |



#### 2.22 根据危急值ID获取危急值详细信息 ####

适应于根据危急值ID获取危急值详细信息用于界面呈现等。 
```vb
##Class(BSP.CV.SRV.Interface).GetCVDetailsInfo(reportID)
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 空 | 获取失败 |  |
| 对象 | 获取成功 | `BSP.SYS.COM.ProxyObject`对象 |

成功返回的是`BSP.SYS.COM.ProxyObject`对象，具体属性

|*属性名* |*说明*|*备注*|
| --- | -- | -- |
| success | 成功与否 | 1成功 0失败 | 
| msg | 错误提示信息 |  | 
| rowid | 危急值id |  | 
| repType | 危急值类型 |  | 
| repTypeDesc | 危急值类型描述 |  | 
| repLabno | 检查(检验)号 |  | 
| repDateDesc | 报告日期 | 格式为HIS系统配置 | 
| repTime | 报告时间 | HH:mm:ss | 
| repUserName | 报告人姓名 |  | 
| repStatus | 报告状态 | C未处理，Rec已接收，F已处理，D撤销 | 
| hasNurE | 护士是否已处理 | 不通用，个别项目 | 
| nurseDoneStatus  | 护士是否已完成 | 1已完成(已接收，个别项目为护士是否已处理)，0未完成 | 
| repResult | 危急值报告内容 |  | 
| ordItm | 医嘱ID | 存在多个医嘱ID可能，英文逗号分隔 | 
| ordDesc | 医嘱名称 |  | 
| ordDocName | 开单医生 |  | 
| ordLocDesc | 开单科室 |  | 
| EpisodeID | 就诊ID |  | 
| admType | 就诊类型 |  | 
| admLoc | 就诊科室ID |  | 
| admLocDesc | 就诊科室名称 |  | 
| admDocName | 主管医生 |  | 
| admDate | 就诊日期 | 格式为HIS系统配置 | 
| admLocPhone | 就诊科室电话 |  | 
| mradm | mradm |  | 
| PatientID | 患者ID |  | 
| patName | 患者姓名 |  | 
| gender | 性别 |  | 
| DOB | 生日 | 格式为HIS系统配置 | 
| age | 年龄 |  | 
| PAPMINO | 登记号 |  | 
| patPhone | 患者电话 |  | 
| patMrNo | 病案号 |  | 
| transArray | 处理记录数组 | 危急值的接收、转发、处理、记录，数组(BSP.SYS.COM.ProxyArray)对象 | 

处理记录transArray的元素说明

|*属性名* |*说明*|*备注*|
| --- | -- | -- |
| trUserName | 操作人姓名 |  | 
| trDate | 操作日期 | 格式为HIS系统配置 | 
| trTime | 操作时间 | HH:mm:ss | 
| trContact | 联系人 |  | 
| trPhone | 联系电话 |  | 
| trMemo | 联系结果描述 | \[已通知,未联系到\] | 
| trStatus | 联系结果 | \[F,C\] | 
| trAdvice | 接收备注、处理意见措施 |  | 
| trExecResult | 处理结果代码 | 个别项目此为联系结果的替代()，标版未用 | 
| trOpType | 操作类型 | Rec接收，E处理，FwD转发，NurRec护士接收，NurE护士处理，D撤销 <br>护士接收、护士处理仅个别项目独立区分 | 



#### 2.23 危急值阅读 ####

适应于提供危急值首次阅读接口给第三方（PDA等）。  

```vb
##Class(BSP.CV.SRV.Interface).SaveFirstRead(reportID, usercode,sessLocCode)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID   | 危急值ID    |  |
| usercode   | 完成状态    | 阅读人工号 |
| sessLocCode   | 操作科室代码    | 操作用户登录的科室 |


|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| -1^失败原因 | 失败 |  |
| 1 | 成功 |  |


#### 2.24 危急值接收 ####

适应于提供危急值接收接口给第三方（PDA等）。  

个别项目将护士接收称作【护士处理】。

```vb
##Class(BSP.CV.SRV.Interface).SaveReceive(reportID, contact,contactTel,contactResult,contactResultDesc,note,usercode,contactCode,sessLocCode)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| reportID | 危急值ID |  | 
| contact | 联系人姓名 | 一般指医生 | 
| contactTel | 联系人电话 | 一般指医生 | 
| contactResult | 联系结果 | \[F,C\] | 
| contactResultDesc | 联系结果描述 | \[已通知,未联系到\] | 
| note | 备注 |  | 
| usercode | 操作人工号 |  | 
| contactCode | 联系人工号 | 部分项目联系人为下拉选择医生 | 
| sessLocCode | 操作科室代码 | 操作用户登录的科室 | 


|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| -1^失败原因 | 失败 |  |
| 1 | 成功 |  |



#### 2.25 患者新就诊记录时V2 ####

适应于患者新就诊（产生了就诊记录有了科室、病区后）时调用，处理患者之前的危急值数据（如处理消息，发新消息，修改危急值最终科室）。  `个别项目`
```vb
##Class(BSP.CV.SRV.Interface).OnNewAdmV2(Adm,UserID)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 大于等于0 | 成功 | 成功返回：大于等于0的数,0表示没有要操作的危急值，大于0表示操作的危急值条数  |
| -1^失败原因 |  | |


#### 2.26 患者转科后V2 ####

适应于患者转科后(就诊记录上科室病区改变后)调用，处理患者之前的危急值数据（如处理消息，发新消息，修改危急值最终科室）。  `个别项目`
```vb
##Class(BSP.CV.SRV.Interface).OnTransLocV2(Adm,UserID)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |
| UserID   | 操作人ID    |  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 大于等于0 | 成功 | 成功返回：大于等于0的数,0表示没有要操作的危急值，大于0表示操作的危急值条数 |
| -1^失败原因 |  | |


#### 2.27 获取患者要弹出的危急值链接 ####

适应于获取患者一段时间内是否有未处理的危急值（历次就诊记录的），有则返回需要弹出的链接，没有则返回空。  `个别项目`
```vb
##Class(BSP.CV.SRV.Interface).GetPatPopupUrl(Adm)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 空 | 无 |  |
| 其它 | 有 | 有未处理的危急值返回url链接 |


#### 2.28 是否有超时处理以及超时未处理危急值 ####

适应于判断患者是否有超时处理以及超时未处理危急值。
```vb
##Class(BSP.CV.SRV.Interface).IfAdmHasOverTimeCV(Adm)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 有 |  |
| 0 | 无 | |


#### 2.29 此前24小时内是否产生过危急值 ####

适应于判断患者在此前24小时内是否产生过危急值。
```vb
##Class(BSP.CV.SRV.Interface).IfAdmHasCVIn24H(Adm)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 有 |  |
| 0 | 无 | |


#### 2.30 患者一段时间内是否产生过危急值 ####

适应于判断患者在一段时间内是否产生过危急值。
```vb
##Class(BSP.CV.SRV.Interface).IfHasCVReport(Adm,Status,StDate,StTime,EndDate,EndTime)  
```

| *参数名* | *说明*      | *备注*                                                 |
| -------------- | ----------------- | ------------------------------------------------------------ |
| Adm   | 就诊ID    |   |
| Status   | 当前状态    |  C未接收 Rec已接收 F已处理 D已撤回 空(除了撤销外的所有危急值)  |
| StDate   | 开始日期   | yyyy-MM-dd  |
| StTime   | 开始时间   | hh:mm:ss  |
| EndDate   | 结束日期  | yyyy-MM-dd  |
| EndTime   | 结束时间  | hh:mm:ss  |

|*返回值* |*说明*|*备注*|
| --- | -- | -- |
| 1 | 有 |  |
| 0 | 无 | |

